{% extends "Base.html" %}

{% block title %}Simulador de Fretes{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Simulador de Custos de Frete</h4>
        </div>
        <div class="card-body">
            <p class="card-text">Insira os dados de uma ou mais remessas para calcular e comparar os custos de frete com base nas tabelas de acordos mais recentes.</p>
            
            <form action="{{ url_for('simulador.index') }}" method="POST">
                <div id="shipments-container">
                    <div class="row font-weight-bold d-none d-md-flex mb-2">
                        <div class="col-md-4"><span>Origem</span></div>
                        <div class="col-md-4"><span>Destino</span></div>
                        <div class="col-md-3"><span>Peso Taxado (Kg)</span></div>
                        <div class="col-md-1"></div>
                    </div>
                        <div class="row shipment-row mb-2">
                            <div class="col">
                                <input type="text" class="form-control" name="origem" placeholder="Origem (Ex: GRU)" required>
                            </div>
                            <div class="col">
                                <input type="text" class="form-control" name="destino" placeholder="Destino (Ex: MAO)" required>
                            </div>
                            <div class="col">
                                <input type="text" class="form-control" name="peso_taxado" placeholder="Peso (kg)" required>
                            </div>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn btn-danger btn-sm w-100 remove-shipment-btn" disabled>
                                &times;
                            </button>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="d-flex justify-content-between">
                    <button type="button" id="add-shipment-btn" class="btn btn-secondary">
                        <i class="fas fa-plus"></i> Adicionar Remessa
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-calculator"></i> Simular Custos
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('shipments-container');
    const addBtn = document.getElementById('add-shipment-btn');

    // Função para clonar e adicionar uma nova linha de remessa
    addBtn.addEventListener('click', function() {
        const firstRow = container.querySelector('.shipment-row');
        const newRow = firstRow.cloneNode(true);
        
        // Limpa os valores dos inputs clonados
        newRow.querySelectorAll('input').forEach(input => input.value = '');
        
        // Habilita o botão de remover na nova linha e nas existentes
        const removeBtn = newRow.querySelector('.remove-shipment-btn');
        removeBtn.disabled = false;
        
        container.querySelectorAll('.remove-shipment-btn').forEach(btn => btn.disabled = false);

        container.appendChild(newRow);
    });

    // Função para remover uma linha de remessa (delegação de evento)
    container.addEventListener('click', function(e) {
        if (e.target && e.target.classList.contains('remove-shipment-btn')) {
            const rowToRemove = e.target.closest('.shipment-row');
            rowToRemove.remove();
            
            // Se restar apenas uma linha, desabilita o botão de remover dela
            if (container.querySelectorAll('.shipment-row').length === 1) {
                container.querySelector('.remove-shipment-btn').disabled = true;
            }
        }
    });
});
</script>

{% endblock %}